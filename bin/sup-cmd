#!/usr/bin/env ruby
require 'rubygems'
require 'trollop'
require 'sup/protocol'
require 'pp'
include Redwood

c = Protocol.tcp 'localhost'

c.write :count,
        :query => ARGV.first,
        :tag => 2
pp c.read

c.write :query,
        :query => ARGV.first,
        :limit => 3,
        :fields => [:from, :subject],
        :tag => 1
while ((x = c.read) && x.first != :done)
  pp x
end
